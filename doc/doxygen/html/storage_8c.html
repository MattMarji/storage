<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ECE297 Storage Server: storage.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<h1>storage.c File Reference</h1>  </div>
</div>
<div class="contents">

<p>This file contains the implementation of the storage server interface as specified in <a class="el" href="storage_8h.html" title="This file defines the interface between the storage client and server.">storage.h</a>.  
<a href="#_details">More...</a></p>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;sys/socket.h&gt;</code><br/>
<code>#include &lt;netdb.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="storage_8h_source.html">storage.h</a>&quot;</code><br/>
<code>#include &quot;client.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">utils.h</a>&quot;</code><br/>
<code>#include &lt;sys/time.h&gt;</code><br/>

<p><a href="storage_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a24a31f60b063af0e662125ea2427b140"></a><!-- doxytag: member="storage.c::LOGGING" ref="a24a31f60b063af0e662125ea2427b140" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>LOGGING</b>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="storage_8c.html#abc3751ffba629aad5a4b8c7c22a75e11">storage_connect</a> (const char *hostname, const int port)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Establish a connection to the server.  <a href="#abc3751ffba629aad5a4b8c7c22a75e11"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="storage_8c.html#aa97b5545b3eefb5055a4e6febd375796">storage_auth</a> (const char *username, const char *passwd, void *conn)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This is the authentication function, this function will send the client information to the server and verify that information with the deafult.conf file. Once the information has been verified this function will return a code depending on the status of the verification. if it returned 0 then the authentication is successful. If another number is returned however, then an error occured. The type of error is determined by the code that is returned.  <a href="#aa97b5545b3eefb5055a4e6febd375796"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="storage_8c.html#ac75689ee50898a2f6580c6489e886b59">storage_get</a> (const char *<a class="el" href="structtable.html">table</a>, const char *key, struct <a class="el" href="structstorage__record.html">storage_record</a> *record, void *conn)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This is just a minimal stub implementation. You should modify it according to your design.  <a href="#ac75689ee50898a2f6580c6489e886b59"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="storage_8c.html#a8a42f72670cdcd7bf83416df1f1b090d">storage_set</a> (const char *<a class="el" href="structtable.html">table</a>, const char *key, struct <a class="el" href="structstorage__record.html">storage_record</a> *record, void *conn)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This is just a minimal stub implementation. You should modify it according to your design.  <a href="#a8a42f72670cdcd7bf83416df1f1b090d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="storage_8c.html#af4e09b41d2bc5b8c25936fe952e748b2">storage_query</a> (const char *<a class="el" href="structtable.html">table</a>, const char *predicates, char **keys, const int max_keys, void *conn)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Query the table for records, and retrieve the matching keys.  <a href="#af4e09b41d2bc5b8c25936fe952e748b2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="storage_8c.html#acd449536193542befbae2ff5e916f657">storage_disconnect</a> (void *conn)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This is just a minimal stub implementation. You should modify it according to your design.  <a href="#acd449536193542befbae2ff5e916f657"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad64fceadc9d5019984552bec79f20fa2"></a><!-- doxytag: member="storage.c::AUTH_STATUS" ref="ad64fceadc9d5019984552bec79f20fa2" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>AUTH_STATUS</b> = 1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac150629b1ddaf346deeb080745b53c9b"></a><!-- doxytag: member="storage.c::holder" ref="ac150629b1ddaf346deeb080745b53c9b" args="[100]" -->
char&nbsp;</td><td class="memItemRight" valign="bottom"><b>holder</b> [100]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a921a51efabbd17451ca116ab58ce0609"></a><!-- doxytag: member="storage.c::fpCLIENT" ref="a921a51efabbd17451ca116ab58ce0609" args="" -->
FILE *&nbsp;</td><td class="memItemRight" valign="bottom"><b>fpCLIENT</b> = NULL</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>This file contains the implementation of the storage server interface as specified in <a class="el" href="storage_8h.html" title="This file defines the interface between the storage client and server.">storage.h</a>. </p>

<p>Definition in file <a class="el" href="storage_8c_source.html">storage.c</a>.</p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aa97b5545b3eefb5055a4e6febd375796"></a><!-- doxytag: member="storage.c::storage_auth" ref="aa97b5545b3eefb5055a4e6febd375796" args="(const char *username, const char *passwd, void *conn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int storage_auth </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>passwd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>conn</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This is the authentication function, this function will send the client information to the server and verify that information with the deafult.conf file. Once the information has been verified this function will return a code depending on the status of the verification. if it returned 0 then the authentication is successful. If another number is returned however, then an error occured. The type of error is determined by the code that is returned. </p>
<p>Authenticate the client's connection to the server. </p>

<p>Definition at line <a class="el" href="storage_8c_source.html#l00105">105</a> of file <a class="el" href="storage_8c_source.html">storage.c</a>.</p>

<p>References <a class="el" href="storage_8h_source.html#l00042">ERR_AUTHENTICATION_FAILED</a>, <a class="el" href="utils_8c_source.html#l00207">generate_encrypted_password()</a>, <a class="el" href="utils_8c_source.html#l00040">recvline()</a>, and <a class="el" href="utils_8c_source.html#l00020">sendall()</a>.</p>

<p>Referenced by <a class="el" href="autoshell_8c_source.html#l00031">main()</a>.</p>

</div>
</div>
<a class="anchor" id="abc3751ffba629aad5a4b8c7c22a75e11"></a><!-- doxytag: member="storage.c::storage_connect" ref="abc3751ffba629aad5a4b8c7c22a75e11" args="(const char *hostname, const int port)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* storage_connect </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>hostname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>port</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Establish a connection to the server. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hostname</em>&nbsp;</td><td>The IP address or hostname of the server. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>The TCP port of the server. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>If successful, return a pointer to a data structure that represents a connection to the server. Otherwise return NULL.</dd></dl>
<p>On error, errno will be set to one of the following, as appropriate: ERR_INVALID_PARAM, ERR_CONNECTION_FAIL, or ERR_UNKNOWN. </p>

<p><p>Client connects! REASONING: We will have to ensure that the user correctly enters the required hostname and password. we will LOG what the user enters for the hostname and password, as well as what time they connect. NOTE: If this log does not get written, the client has likely not entered a valid hostname and/or password LOGGER 1! If connection to server not made, return NULL, ELSE if connection made, return socket value (integer).</p>
</p>

<p>Definition at line <a class="el" href="storage_8c_source.html#l00031">31</a> of file <a class="el" href="storage_8c_source.html">storage.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l00197">currentDateTime()</a>, and <a class="el" href="utils_8c_source.html#l00180">logger()</a>.</p>

<p>Referenced by <a class="el" href="autoshell_8c_source.html#l00031">main()</a>.</p>

</div>
</div>
<a class="anchor" id="acd449536193542befbae2ff5e916f657"></a><!-- doxytag: member="storage.c::storage_disconnect" ref="acd449536193542befbae2ff5e916f657" args="(void *conn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int storage_disconnect </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>conn</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This is just a minimal stub implementation. You should modify it according to your design. </p>
<p>Close the connection to the server. </p>

<p>Definition at line <a class="el" href="storage_8c_source.html#l00514">514</a> of file <a class="el" href="storage_8c_source.html">storage.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l00197">currentDateTime()</a>, and <a class="el" href="utils_8c_source.html#l00180">logger()</a>.</p>

<p>Referenced by <a class="el" href="autoshell_8c_source.html#l00031">main()</a>.</p>

</div>
</div>
<a class="anchor" id="ac75689ee50898a2f6580c6489e886b59"></a><!-- doxytag: member="storage.c::storage_get" ref="ac75689ee50898a2f6580c6489e886b59" args="(const char *table, const char *key, struct storage_record *record, void *conn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int storage_get </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structstorage__record.html">storage_record</a> *&nbsp;</td>
          <td class="paramname"> <em>record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>conn</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This is just a minimal stub implementation. You should modify it according to your design. </p>
<p>Retrieve the value associated with a key in a table. </p>

<p>Definition at line <a class="el" href="storage_8c_source.html#l00174">174</a> of file <a class="el" href="storage_8c_source.html">storage.c</a>.</p>

<p>References <a class="el" href="storage_8h_source.html#l00044">ERR_KEY_NOT_FOUND</a>, <a class="el" href="storage_8h_source.html#l00043">ERR_TABLE_NOT_FOUND</a>, <a class="el" href="utils_8c_source.html#l00180">logger()</a>, <a class="el" href="utils_8c_source.html#l00040">recvline()</a>, <a class="el" href="utils_8c_source.html#l00020">sendall()</a>, <a class="el" href="utils_8c_source.html#l00215">valid_string_check()</a>, and <a class="el" href="storage_8h_source.html#l00056">storage_record::value</a>.</p>

<p>Referenced by <a class="el" href="autoshell_8c_source.html#l00031">main()</a>.</p>

</div>
</div>
<a class="anchor" id="af4e09b41d2bc5b8c25936fe952e748b2"></a><!-- doxytag: member="storage.c::storage_query" ref="af4e09b41d2bc5b8c25936fe952e748b2" args="(const char *table, const char *predicates, char **keys, const int max_keys, void *conn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int storage_query </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>predicates</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>keys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>max_keys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>conn</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Query the table for records, and retrieve the matching keys. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>table</em>&nbsp;</td><td>A table in the database. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>predicates</em>&nbsp;</td><td>A comma separated list of predicates. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>keys</em>&nbsp;</td><td>An array of strings where the keys whose records match the specified predicates will be copied. The array must have room for at least max_keys elements. The caller must allocate memory for this array. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>max_keys</em>&nbsp;</td><td>The size of the keys array. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>conn</em>&nbsp;</td><td>A connection to the server. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Return the number of matching keys (which may be more than max_keys) if successful, and -1 otherwise.</dd></dl>
<p>On error, errno will be set to one of the following, as appropriate: ERR_INVALID_PARAM, ERR_CONNECTION_FAIL, ERR_TABLE_NOT_FOUND, ERR_KEY_NOT_FOUND, ERR_NOT_AUTHENTICATED, or ERR_UNKNOWN.</p>
<p>Each predicate consists of a column name, an operator, and a value, each separated by optional whitespace. The operator may be a "=" for string types, or one of "&lt;, &gt;, =" for int and float types. An example of query predicates is "name = bob, mark &gt; 90". </p>

<p>Definition at line <a class="el" href="storage_8c_source.html#l00368">368</a> of file <a class="el" href="storage_8c_source.html">storage.c</a>.</p>

<p>References <a class="el" href="storage_8h_source.html#l00039">ERR_INVALID_PARAM</a>, <a class="el" href="storage_8h_source.html#l00043">ERR_TABLE_NOT_FOUND</a>, <a class="el" href="utils_8c_source.html#l00180">logger()</a>, <a class="el" href="storage_8h_source.html#l00029">MAX_KEY_LEN</a>, <a class="el" href="utils_8c_source.html#l00040">recvline()</a>, <a class="el" href="utils_8c_source.html#l00020">sendall()</a>, and <a class="el" href="utils_8c_source.html#l00215">valid_string_check()</a>.</p>

<p>Referenced by <a class="el" href="client_8c_source.html#l00041">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a8a42f72670cdcd7bf83416df1f1b090d"></a><!-- doxytag: member="storage.c::storage_set" ref="a8a42f72670cdcd7bf83416df1f1b090d" args="(const char *table, const char *key, struct storage_record *record, void *conn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int storage_set </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structstorage__record.html">storage_record</a> *&nbsp;</td>
          <td class="paramname"> <em>record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>conn</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This is just a minimal stub implementation. You should modify it according to your design. </p>
<p>Store a key/value pair in a table. </p>

<p>Definition at line <a class="el" href="storage_8c_source.html#l00263">263</a> of file <a class="el" href="storage_8c_source.html">storage.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l00197">currentDateTime()</a>, <a class="el" href="utils_8c_source.html#l00180">logger()</a>, <a class="el" href="utils_8c_source.html#l00040">recvline()</a>, <a class="el" href="utils_8c_source.html#l00020">sendall()</a>, <a class="el" href="utils_8c_source.html#l00215">valid_string_check()</a>, and <a class="el" href="storage_8h_source.html#l00056">storage_record::value</a>.</p>

<p>Referenced by <a class="el" href="autoshell_8c_source.html#l00031">main()</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Mar 26 2013 22:10:56 for ECE297 Storage Server by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
