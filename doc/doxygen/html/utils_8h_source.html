<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ECE297 Storage Server: utils.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>utils.h</h1>  </div>
</div>
<div class="contents">
<a href="utils_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00008"></a>00008 <span class="preprocessor">#ifndef UTILS_H</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span><span class="preprocessor">#define UTILS_H</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="storage_8h.html" title="This file defines the interface between the storage client and server.">storage.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
<a name="l00015"></a>00015 
<a name="l00020"></a>00020 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> CONFIG_COMMENT_CHAR = <span class="charliteral">&#39;#&#39;</span>;
<a name="l00021"></a>00021 
<a name="l00025"></a><a class="code" href="utils_8h.html#a1eb73c104b484cf18752169509cebfe2">00025</a> <span class="preprocessor">#define MAX_CMD_LEN (1024 * 8)</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span>
<a name="l00034"></a><a class="code" href="utils_8h.html#af855c94dc540e943632089ce7496faac">00034</a> <span class="preprocessor">#define LOG(x)  {printf x; fflush(stdout);}</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span>
<a name="l00043"></a>00043 <span class="preprocessor">#ifdef NDEBUG</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#define DBG(x)  {}</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00046"></a><a class="code" href="utils_8h.html#a32adf79142f0a426b5e782fb7cd4cad3">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define DBG(x)  {printf x; fflush(stdout);}</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00052"></a><a class="code" href="structconfig__params.html">00052</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00054"></a><a class="code" href="structconfig__params.html#a962b7bcdbee26333fa776115ed066fb3">00054</a>         <span class="keywordtype">char</span> server_host[MAX_HOST_LEN];
<a name="l00055"></a>00055 
<a name="l00057"></a><a class="code" href="structconfig__params.html#aa7103926e2d35a5d3461a5081723bdcd">00057</a>         <span class="keywordtype">int</span> server_port;
<a name="l00058"></a>00058 
<a name="l00060"></a><a class="code" href="structconfig__params.html#a4793ceaa4b04decbe50ff4fa9fdde145">00060</a>         <span class="keywordtype">char</span> username[MAX_USERNAME_LEN];
<a name="l00061"></a>00061 
<a name="l00063"></a><a class="code" href="structconfig__params.html#a287adb79846d3b33b2e2bdd0cd12f901">00063</a>         <span class="keywordtype">char</span> password[MAX_ENC_PASSWORD_LEN];
<a name="l00064"></a>00064         
<a name="l00066"></a><a class="code" href="structconfig__params.html#acf98ee293155eae13cfd23b30435e133">00066</a>         <span class="keywordtype">char</span> table_names[MAX_TABLES][MAX_TABLE_LEN];
<a name="l00067"></a>00067 
<a name="l00068"></a>00068         <span class="keywordtype">int</span> num_tables;
<a name="l00069"></a>00069 
<a name="l00071"></a>00071 <span class="comment">//      char data_directory[MAX_PATH_LEN];</span>
<a name="l00072"></a>00072 }<a class="code" href="structconfig__params.html" title="A struct to store config parameters.">config_params</a>;
<a name="l00073"></a>00073 
<a name="l00074"></a><a class="code" href="structtable.html">00074</a> <span class="keyword">struct </span><a class="code" href="structtable.html">table</a>{
<a name="l00075"></a>00075   <span class="keywordtype">int</span> numkeys; <span class="comment">//For HEINDRIK-SET to populate</span>
<a name="l00076"></a>00076   <span class="keywordtype">int</span> numCols; <span class="comment">//Stores the number of columns expected for EACH table</span>
<a name="l00077"></a>00077   <span class="keywordtype">int</span> row_index; <span class="comment">//This is the size of array_config</span>
<a name="l00078"></a>00078   <span class="keywordtype">char</span> *table_name;
<a name="l00079"></a>00079   <span class="keywordtype">char</span> array_config[1024][MAX_COLNAME_LEN];
<a name="l00080"></a>00080   <span class="keywordtype">char</span> array_empty[4096][MAX_COLNAME_LEN]; <span class="comment">//</span>
<a name="l00081"></a>00081   <span class="keywordtype">char</span> array_keys[MAX_RECORDS_PER_TABLE][MAX_KEY_LEN];
<a name="l00082"></a>00082   <span class="keyword">struct </span><a class="code" href="structtable.html">table</a> *next;
<a name="l00083"></a>00083 };
<a name="l00084"></a>00084 
<a name="l00085"></a><a class="code" href="structconfiguration.html">00085</a> <span class="keyword">struct </span><a class="code" href="structconfiguration.html">configuration</a> {
<a name="l00086"></a>00086   <span class="keywordtype">char</span> *host;
<a name="l00087"></a>00087   <span class="keywordtype">char</span> *username;
<a name="l00088"></a>00088   <span class="keywordtype">char</span> *password;
<a name="l00089"></a>00089   <span class="keywordtype">int</span> port;
<a name="l00090"></a>00090   <span class="keywordtype">int</span> num_tables;
<a name="l00091"></a>00091   <span class="keywordtype">char</span> all_table_names[MAX_TABLES][MAX_TABLE_LEN];
<a name="l00092"></a>00092   <span class="keywordtype">char</span> set_values[20][20]; <span class="comment">// store the column names and values</span>
<a name="l00093"></a>00093   <span class="keywordtype">int</span> numValues; <span class="comment">// store the size of set_values!</span>
<a name="l00094"></a>00094   <span class="keywordtype">char</span> predicates [100][100]; <span class="comment">// store the predicates for query here</span>
<a name="l00095"></a>00095   <span class="keywordtype">int</span> totPredicates; <span class="comment">//store the length of that string here</span>
<a name="l00096"></a>00096   <span class="keyword">struct </span><a class="code" href="structtable.html">table</a> *tlist;
<a name="l00097"></a>00097 };
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structconfiguration.html">configuration</a> *c;
<a name="l00100"></a>00100 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structtable.html">table</a> *tl;
<a name="l00101"></a>00101 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structtable.html">table</a> *t;
<a name="l00108"></a>00108 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> die(<span class="keywordtype">char</span> *msg, <span class="keywordtype">int</span> code)
<a name="l00109"></a>00109 {
<a name="l00110"></a>00110         printf(<span class="stringliteral">&quot;%s\n&quot;</span>, msg);
<a name="l00111"></a>00111         exit(code);
<a name="l00112"></a>00112 }
<a name="l00113"></a>00113 
<a name="l00120"></a>00120 <span class="keywordtype">int</span> <a class="code" href="utils_8c.html#a73c4a410d877b6a9358c547786f2102c" title="Keep sending the contents of the buffer until complete.">sendall</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> sock, <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, <span class="keyword">const</span> <span class="keywordtype">size_t</span> len);
<a name="l00121"></a>00121 
<a name="l00126"></a>00126 <span class="keywordtype">int</span> <a class="code" href="utils_8c.html#ab126c8228ad72abbaed5f282709446ab" title="Receive an entire line from a socket.">recvline</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> sock, <span class="keywordtype">char</span> *buf, <span class="keyword">const</span> <span class="keywordtype">size_t</span> buflen);
<a name="l00127"></a>00127 
<a name="l00135"></a>00135 <span class="keywordtype">int</span> <a class="code" href="utils_8c.html#a68238ca65153bacb8d086ad1f9e7454f" title="Read and load configuration parameters.">read_config</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *config_file, <a class="code" href="structconfig__params.html" title="A struct to store config parameters.">config_params</a> *params);
<a name="l00136"></a>00136 
<a name="l00143"></a>00143 <span class="keywordtype">void</span> <a class="code" href="utils_8c.html#a97520ee582f1b7eb4c3ab665315b53c9" title="Generates a log message.">logger</a>(FILE *file, <span class="keywordtype">char</span> *message, <span class="keywordtype">int</span> LOGGER);
<a name="l00144"></a>00144 
<a name="l00149"></a>00149 <span class="comment">//This function will print the current date and time.</span>
<a name="l00150"></a>00150 <span class="keywordtype">char</span> *<a class="code" href="utils_8c.html#a91c23a27b0bd2e2f848910ec5bc80d6d" title="Default two character salt used for password encryption.">currentDateTime</a>();
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 <span class="preprocessor">#define DEFAULT_CRYPT_SALT &quot;xx&quot;</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>
<a name="l00163"></a>00163 <span class="keywordtype">char</span> *<a class="code" href="utils_8c.html#aa26d27a9072e93c052cb0c7fca7909f7" title="Generates an encrypted password string using salt CRYPT_SALT.">generate_encrypted_password</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *passwd, <span class="keyword">const</span> <span class="keywordtype">char</span> *salt);
<a name="l00164"></a>00164 
<a name="l00170"></a>00170 <span class="keywordtype">int</span> <a class="code" href="utils_8c.html#ac150a30c67cc0f43a3f54972b4a7bf71" title="This &amp;quot;valid_string_check&amp;quot; function will take in a string and check whether this string cont...">valid_string_check</a>(<span class="keywordtype">char</span>* input,<span class="keywordtype">int</span> value);
<a name="l00171"></a>00171 
<a name="l00175"></a>00175 <span class="keywordtype">char</span>* <a class="code" href="utils_8c.html#aea27bf24a79a23c98e46d1ade98a8437" title="this function will replace all the spaces within a string into a &amp;#39;#&amp;#39; for storing purposes in ...">add_delimiter</a>(<span class="keywordtype">char</span> *input);
<a name="l00176"></a>00176 
<a name="l00180"></a>00180 <span class="keywordtype">char</span>* <a class="code" href="utils_8c.html#ac929c9c0e910bab8124021b6b3fbe4fa" title="this function will replace all the &amp;#39;#&amp;#39; within a string into a &amp;#39; &amp;#39; for retrieving purp...">undo_delimiter</a>(<span class="keywordtype">char</span> *input);
<a name="l00181"></a>00181 
<a name="l00188"></a>00188 <span class="keywordtype">int</span> <a class="code" href="utils_8c.html#a40046deaf7bc9e0467bd658f9c660c90" title="The following two functions below are used to time the execution time of the server, and the storage. &amp;quot;timeval_subtract&amp;quot; subtracts final and the initial value to get the elapsed time. &amp;quot;timeval_print&amp;quot; will print out the value of &amp;quot;timeval_subtract&amp;quot;.">timeval_subtract</a>(<span class="keyword">struct</span> timeval *result, <span class="keyword">struct</span> timeval *t2, <span class="keyword">struct</span> timeval *t1);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 <span class="keywordtype">void</span> timeval_print(<span class="keyword">struct</span> timeval *tv);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 <span class="comment">//char * checkSpaces(char *array);</span>
<a name="l00193"></a>00193 
<a name="l00199"></a>00199 <span class="keywordtype">int</span> <a class="code" href="utils_8c.html#ae27ef67d16072bdf7f42e770800e131b" title="The type_identifier function will receive a string and check whether it is all numbers or not...">type_identifier</a> (<span class="keywordtype">char</span> <span class="keywordtype">string</span>[800]);
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 <span class="keywordtype">int</span> size_get (<span class="keywordtype">char</span> <span class="keywordtype">string</span>[800]);
<a name="l00202"></a>00202 <span class="preprocessor">#endif</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Mar 26 2013 22:10:56 for ECE297 Storage Server by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
